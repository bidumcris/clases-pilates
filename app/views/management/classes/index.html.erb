<div class="admin-classes">
  <div class="admin-page-header">
    <h1>Gestión de Clases</h1>
    <% if current_user.admin? %>
      <%= link_to "Nueva Clase", new_management_class_path, class: "btn btn-primary" %>
      <%= link_to "Panel Avanzado (ActiveAdmin)", admin_root_path, class: "btn btn-outline" %>
    <% end %>
  </div>

  <!-- Navegación Semanal -->
  <div class="calendar-navigation">
    <%= link_to management_classes_path(date: (@week_start - 7.days).to_s), class: "btn btn-outline" do %>
      ← Semana Anterior
    <% end %>
    
    <div class="week-display">
      <h2>
        <%= I18n.l(@week_start, format: "%d de %B") %> - 
        <%= I18n.l(@week_end, format: "%d de %B de %Y") %>
      </h2>
    </div>
    
    <%= link_to management_classes_path(date: (@week_start + 7.days).to_s), class: "btn btn-outline" do %>
      Semana Siguiente →
    <% end %>
  </div>

  <!-- Calendario Semanal -->
  <div class="calendar-week-container">
    <% (@week_start..@week_end).each do |day| %>
      <% day_classes = @classes_by_day[day] || [] %>
      <div class="calendar-day admin-day">
        <div class="day-header">
          <strong><%= I18n.l(day, format: "%A %d") %></strong>
          <span class="day-classes-count"><%= day_classes.count %> clase<%= 's' if day_classes.count != 1 %></span>
        </div>
        
        <% if day_classes.any? %>
          <% day_classes.group_by { |c| c.start_time.hour }.each do |hour, classes_at_hour| %>
            <div class="hour-block">
              <div class="hour-label"><%= hour %>:00</div>
              <% classes_at_hour.each do |pilates_class| %>
                <div class="class-item admin-class-item">
                  <div class="class-info">
                    <strong><%= pilates_class.name %></strong>
                    <p class="class-details">
                      <%= pilates_class.room.name %> - <%= pilates_class.instructor.name %>
                    </p>
                    <p class="class-time">
                      <%= pilates_class.start_time.strftime("%H:%M") %> - <%= pilates_class.end_time.strftime("%H:%M") %>
                    </p>
                    <p class="class-level">
                      Nivel: <strong><%= pilates_class.level.humanize %></strong>
                      <span class="class-type-badge <%= pilates_class.privada? ? 'badge-warning' : 'badge-success' %>">
                        <%= pilates_class.class_type.humanize %>
                      </span>
                    </p>
                    <p class="class-capacity">
                      <%= pilates_class.available_spots %>/<%= pilates_class.max_capacity %> disponibles
                    </p>
                  </div>
                  <div class="class-actions">
                    <%= link_to "Tomar lista", attendance_management_class_path(pilates_class), class: "btn btn-sm btn-outline" %>
                    <% if current_user.admin? %>
                      <%= link_to "Editar", edit_management_class_path(pilates_class), class: "btn btn-sm btn-primary" %>
                      <%= button_to "Eliminar", management_class_path(pilates_class), method: :delete, 
                          class: "btn btn-sm btn-danger", 
                          data: { confirm: "¿Estás seguro de eliminar esta clase?" } %>
                    <% end %>
                  </div>
                </div>
              <% end %>
            </div>
          <% end %>
        <% else %>
          <p class="no-classes">No hay clases este día</p>
        <% end %>
      </div>
    <% end %>
  </div>
</div>
