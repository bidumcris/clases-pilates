<div class="admin-form-page admin-room-service-page">
  <div class="admin-page-header">
    <h1>Servicio: <%= @room.label %> — <%= @room.name %></h1>
    <%= link_to "← Volver a salas", new_management_class_path, class: "btn btn-outline" %>
  </div>

  <div class="admin-section" data-controller="service-sections">
    <div class="service-toggle-buttons">
      <button type="button" class="btn btn-primary btn-large btn-block margedvert" data-action="click->service-sections#toggleDatos">
        Datos del servicio <span class="caret"></span>
      </button>
      <button type="button" class="btn btn-primary btn-large btn-block margedvert" data-action="click->service-sections#toggleConfig">
        Configuración <span class="caret"></span>
      </button>
    </div>

    <%= form_with model: @room, url: management_room_path(@room), method: :patch, local: true, class: "admin-form admin-room-service-form" do |f| %>
      <div class="service-section" data-service-sections-target="datos">
        <h2>Datos del servicio</h2>
        <div class="form-row">
          <div class="form-group">
            <%= f.label :service_kind, "Tipo de servicio (*)" %>
            <%= f.text_field :service_kind, class: "form-control", placeholder: "Ej: Pilates grupal, Circuito, Reformer" %>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <%= f.label :service_name, "Nombre del servicio" %>
            <%= f.text_field :service_name, class: "form-control", placeholder: "Nombre visible para administración" %>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <%= f.label :service_description, "Información descriptiva (*)" %>
            <%= f.text_area :service_description, class: "form-control", rows: 4, placeholder: "Describe el servicio (nivel, objetivos, a quién está dirigido, etc.)" %>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <%= f.label :service_notice, "Información para usuarios del servicio (Cartelera)" %>
            <%= f.text_area :service_notice, class: "form-control", rows: 4, placeholder: "Mensajes importantes que ve el alumno (cartelera, avisos especiales)" %>
          </div>
        </div>
      </div>

      <div class="service-section" data-service-sections-target="config">
        <h2>Configuración</h2>
        <p class="service-section-hint">
          Este bloque define cómo se generan y administran los turnos de esta sala.
        </p>

        <div class="form-row">
          <div class="form-group">
            <%= f.label :service_schedule_description, "Escribe con exactitud tus horarios y días de atención (*)" %>
            <%= f.text_area :service_schedule_description, class: "form-control", rows: 5, placeholder: "Ej: Lunes 19\nMartes 7, 8, 9, 10, 18, 19, 20\nMiércoles 7, 8, 9, 17, 18, 19, 20\nJueves 19, 20, 21", value: @room.service_schedule_description.to_s %>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <%= f.label :service_slot_interval_minutes, "Duración entre turnos (en minutos) (*)" %>
            <%= f.number_field :service_slot_interval_minutes, class: "form-control", min: 1, step: 1, value: @room.service_slot_interval_minutes %>
          </div>
          <div class="form-group">
            <%= f.label :service_duration_minutes, "Duración de atención del servicio (en minutos)" %>
            <%= f.number_field :service_duration_minutes, class: "form-control", min: 0, step: 5, value: @room.service_duration_minutes %>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <%= f.label :service_reserved_fixed_slots, "Reservar N lugares para ofrecer turnos fijos a nuevos alumnos" %>
            <%= f.number_field :service_reserved_fixed_slots, class: "form-control", min: 0, step: 1, value: @room.service_reserved_fixed_slots %>
            <small class="form-hint">
              Lugar 'comodín'. Cuidado: esta es una función AVANZADA. Consúltanos antes de cambiar esto.
            </small>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <%= f.label :service_daily_free_limit, "Cantidad límite de turnos libres o recupero que un alumno puede reservar en 1 día" %>
            <%= f.number_field :service_daily_free_limit, class: "form-control", min: 0, step: 1, value: @room.service_daily_free_limit %>
          </div>
          <div class="form-group">
            <%= f.label :service_weekly_free_limit, "Cantidad límite de turnos libres o recupero que un alumno puede reservar en 1 semana" %>
            <%= f.number_field :service_weekly_free_limit, class: "form-control", min: 0, step: 1, value: @room.service_weekly_free_limit %>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <%= f.label :service_daily_active_limit, "Cantidad máxima de turnos activos que un alumno puede tener en 1 día" %>
            <%= f.number_field :service_daily_active_limit, class: "form-control", min: 0, step: 1, value: @room.service_daily_active_limit %>
          </div>
          <div class="form-group">
            <%= f.label :service_weekly_active_limit, "Cantidad máxima de turnos activos que un alumno puede tener en 1 semana" %>
            <%= f.number_field :service_weekly_active_limit, class: "form-control", min: 0, step: 1, value: @room.service_weekly_active_limit %>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <%= f.label :service_max_days_in_advance, "Cantidad máxima de días previos para que un alumno pueda reservar turno" %>
            <%= f.number_field :service_max_days_in_advance, class: "form-control", min: 0, step: 1, value: @room.service_max_days_in_advance %>
          </div>
        </div>
      </div>

      <div class="form-actions service-save-actions">
        <%= f.submit "Guardar configuración", class: "btn btn-primary btn-large" %>
      </div>

      <p class="service-required-note">(*) Campo requerido</p>
    <% end %>
  </div>
</div>

