<div class="admin-classes">
  <div class="admin-page-header">
    <h1>Alumnos</h1>
  </div>

  <div class="admin-section">
    <h2>Buscar / Filtrar</h2>
    <%= form_with url: management_students_path, method: :get, local: true do %>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1rem; align-items: end;">
        <div>
          <label>Email</label><br>
          <%= text_field_tag :search, params[:search], class: "form-input", placeholder: "usuario@email.com" %>
        </div>
        <div>
          <label>Nivel</label><br>
          <%= select_tag :level,
              options_for_select([["Todos", ""]] + User.levels.keys.map { |k| [k.humanize, k] }, params[:level].to_s),
              class: "form-select" %>
        </div>
        <div>
          <label>Tipo</label><br>
          <%= select_tag :class_type,
              options_for_select([["Todos", ""]] + User.class_types.keys.map { |k| [k.humanize, k] }, params[:class_type].to_s),
              class: "form-select" %>
        </div>
        <div>
          <%= submit_tag "Aplicar", class: "btn btn-primary" %>
        </div>
      </div>
    <% end %>
  </div>

  <div class="admin-section">
    <h2>Listado</h2>
    <% if @students.any? %>
      <table class="admin-table">
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Email</th>
            <th>Activo</th>
            <th>Nivel</th>
            <th>Tipo</th>
            <th>Créditos disponibles</th>
            <th>Deuda</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <% @students.each do |student| %>
            <tr>
              <td><%= student.name.presence || "-" %></td>
              <td><%= student.email %></td>
              <td><%= student.active? ? "Sí" : "No" %></td>
              <td><%= student.level.humanize %></td>
              <td><%= student.class_type.humanize %></td>
              <td><%= student.credits_available %></td>
              <td><%= student.debt_amount ? number_to_currency(student.debt_amount, unit: "$", separator: ",", delimiter: ".") : "-" %></td>
              <td style="display:flex; gap: .5rem; flex-wrap: wrap;">
                <%= link_to "Ver ficha", management_student_path(student), class: "btn btn-sm btn-outline" %>
                <% if current_user.admin? %>
                  <%= link_to "Editar", edit_management_student_path(student), class: "btn btn-sm btn-primary" %>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <p>No hay alumnos para estos filtros.</p>
    <% end %>
  </div>
</div>


