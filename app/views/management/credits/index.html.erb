<div class="admin-classes">
  <div class="admin-page-header">
    <h1>Créditos</h1>
    <%= link_to "Agregar créditos", new_management_credit_path, class: "btn btn-primary" %>
  </div>

  <div class="admin-section">
    <h2>Filtros</h2>
    <%= form_with url: management_credits_path, method: :get, local: true do %>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1rem; align-items: end;">
        <div data-controller="searchable-select">
          <label>Alumno</label><br>
          <%= select_tag :user_id,
              options_for_select([["Todos", ""]] + @students.map { |u| ["#{u.email}", u.id] }, params[:user_id].to_s),
              class: "form-select",
              data: { searchable_select_target: "select", search_placeholder: "Buscar alumno por email..." } %>
        </div>
        <div>
          <label>Usado</label><br>
          <%= select_tag :used,
              options_for_select([["Todos", ""], ["No", "false"], ["Sí", "true"]], params[:used].to_s),
              class: "form-select" %>
        </div>
        <div>
          <label>
            <%= check_box_tag :expired, "1", params[:expired] == "1" %>
            Solo expirados
          </label>
        </div>
        <div>
          <%= submit_tag "Aplicar", class: "btn btn-primary" %>
        </div>
      </div>
    <% end %>
  </div>

  <div class="admin-section">
    <h2>Listado</h2>
    <% if @credits.any? %>
      <table class="admin-table">
        <thead>
          <tr>
            <th>Alumno</th>
            <th>Cantidad</th>
            <th>Expira</th>
            <th>Estado</th>
            <th>Creado</th>
          </tr>
        </thead>
        <tbody>
          <% @credits.each do |credit| %>
            <tr>
              <td><%= link_to credit.user.email, management_student_path(credit.user), class: "link" %></td>
              <td><%= credit.amount %></td>
              <td><%= credit.expires_at.strftime("%d/%m/%Y") %></td>
              <td>
                <% if credit.used? %>
                  Usado
                <% elsif credit.expired? %>
                  Expirado
                <% else %>
                  Disponible
                <% end %>
              </td>
              <td><%= credit.created_at.strftime("%d/%m/%Y %H:%M") %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <p>No hay créditos para estos filtros.</p>
    <% end %>
  </div>
</div>

